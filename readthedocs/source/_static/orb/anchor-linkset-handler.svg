<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="950px" preserveAspectRatio="none" style="width:834px;height:950px;background:#FFFFFF;" version="1.1" viewBox="0 0 834 950" width="834px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="109.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="36.5" y="131.0234"/><rect fill="#FFFFFF" height="551.6563" style="stroke:#181818;stroke-width:1.0;" width="10" x="149.5" y="269.8203"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="346.5" y="457.6172"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="432.5" y="341.0859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="501" y="399.3516"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="560.5" y="581.2813"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="647.5" y="639.5469"/><rect fill="#FFFFFF" height="94.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="736.5" y="697.8125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="41" x2="41" y1="99.8906" y2="839.4766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="154.5" x2="154.5" y1="99.8906" y2="839.4766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="351" x2="351" y1="99.8906" y2="839.4766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="437" x2="437" y1="99.8906" y2="839.4766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="506" x2="506" y1="99.8906" y2="839.4766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="565" x2="565" y1="99.8906" y2="839.4766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="652" x2="652" y1="99.8906" y2="839.4766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="741" x2="741" y1="99.8906" y2="839.4766"/><path d="M10,57.2969 L73,57.2969 C78,57.2969 78,78.5938 78,78.5938 C78,78.5938 78,99.8906 73,99.8906 L10,99.8906 C5,99.8906 5,78.5938 5,78.5938 C5,78.5938 5,57.2969 10,57.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M73,57.2969 C68,57.2969 68,78.5938 68,78.5938 C68,99.8906 73,99.8906 73,99.8906 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="11" y="75.292">Anchor</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="10" y="91.5889">Linkset</text><path d="M10,838.4766 L73,838.4766 C78,838.4766 78,859.7734 78,859.7734 C78,859.7734 78,881.0703 73,881.0703 L10,881.0703 C5,881.0703 5,859.7734 5,859.7734 C5,859.7734 5,838.4766 10,838.4766 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M73,838.4766 C68,838.4766 68,859.7734 68,859.7734 C68,881.0703 73,881.0703 73,881.0703 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="11" y="856.4717">Anchor</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="10" y="872.7686">Linkset</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="93.5" y="52.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="100.5" y="72.292">Anchor Linkset</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="127" y="88.5889">Handler</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="93.5" y="838.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="100.5" y="858.4717">Anchor Linkset</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="127" y="874.7686">Handler</text><path d="M321,73.5938 L382,73.5938 C387,73.5938 387,86.7422 387,86.7422 C387,86.7422 387,99.8906 382,99.8906 L321,99.8906 C316,99.8906 316,86.7422 316,86.7422 C316,86.7422 316,73.5938 321,73.5938 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M382,73.5938 C377,73.5938 377,86.7422 377,86.7422 C377,99.8906 382,99.8906 382,99.8906 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="321" y="91.5889">Anchor</text><path d="M321,838.4766 L382,838.4766 C387,838.4766 387,851.625 387,851.625 C387,851.625 387,864.7734 382,864.7734 L321,864.7734 C316,864.7734 316,851.625 316,851.625 C316,851.625 316,838.4766 321,838.4766 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M382,838.4766 C377,838.4766 377,851.625 377,851.625 C377,864.7734 382,864.7734 382,864.7734 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="321" y="856.4717">Anchor</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="399.5" y="63.9951">Verifiable</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="397" y="80.292">Credential</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="424" y="96.5889">DB</text><path d="M419.5,15 C419.5,5 437.5,5 437.5,5 C437.5,5 455.5,5 455.5,15 L455.5,41 C455.5,51 437.5,51 437.5,51 C437.5,51 419.5,51 419.5,41 L419.5,15 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M419.5,15 C419.5,25 437.5,25 437.5,25 C437.5,25 455.5,25 455.5,15 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="399.5" y="851.4717">Verifiable</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="397" y="867.7686">Credential</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="424" y="884.0654">DB</text><path d="M419.5,897.3672 C419.5,887.3672 437.5,887.3672 437.5,887.3672 C437.5,887.3672 455.5,887.3672 455.5,897.3672 L455.5,923.3672 C455.5,933.3672 437.5,933.3672 437.5,933.3672 C437.5,933.3672 419.5,933.3672 419.5,923.3672 L419.5,897.3672 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M419.5,897.3672 C419.5,907.3672 437.5,907.3672 437.5,907.3672 C437.5,907.3672 455.5,907.3672 455.5,897.3672 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="488.5" y="96.5889">CAS</text><path d="M488,47.5938 C488,37.5938 506,37.5938 506,37.5938 C506,37.5938 524,37.5938 524,47.5938 L524,73.5938 C524,83.5938 506,83.5938 506,83.5938 C506,83.5938 488,83.5938 488,73.5938 L488,47.5938 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M488,47.5938 C488,57.5938 506,57.5938 506,57.5938 C506,57.5938 524,57.5938 524,47.5938 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="488.5" y="851.4717">CAS</text><path d="M488,864.7734 C488,854.7734 506,854.7734 506,854.7734 C506,854.7734 524,854.7734 524,864.7734 L524,890.7734 C524,900.7734 506,900.7734 506,900.7734 C506,900.7734 488,900.7734 488,890.7734 L488,864.7734 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M488,864.7734 C488,874.7734 506,874.7734 506,874.7734 C506,874.7734 524,874.7734 524,864.7734 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="534" y="80.292">Witness</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="552" y="96.5889">DB</text><path d="M547.5,31.2969 C547.5,21.2969 565.5,21.2969 565.5,21.2969 C565.5,21.2969 583.5,21.2969 583.5,31.2969 L583.5,57.2969 C583.5,67.2969 565.5,67.2969 565.5,67.2969 C565.5,67.2969 547.5,67.2969 547.5,57.2969 L547.5,31.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M547.5,31.2969 C547.5,41.2969 565.5,41.2969 565.5,41.2969 C565.5,41.2969 583.5,41.2969 583.5,31.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="534" y="851.4717">Witness</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="552" y="867.7686">DB</text><path d="M547.5,881.0703 C547.5,871.0703 565.5,871.0703 565.5,871.0703 C565.5,871.0703 583.5,871.0703 583.5,881.0703 L583.5,907.0703 C583.5,917.0703 565.5,917.0703 565.5,917.0703 C565.5,917.0703 547.5,917.0703 547.5,907.0703 L547.5,881.0703 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M547.5,881.0703 C547.5,891.0703 565.5,891.0703 565.5,891.0703 C565.5,891.0703 583.5,891.0703 583.5,881.0703 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="607" y="80.292">Anchor Link</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="639" y="96.5889">DB</text><path d="M634.5,31.2969 C634.5,21.2969 652.5,21.2969 652.5,21.2969 C652.5,21.2969 670.5,21.2969 670.5,31.2969 L670.5,57.2969 C670.5,67.2969 652.5,67.2969 652.5,67.2969 C652.5,67.2969 634.5,67.2969 634.5,57.2969 L634.5,31.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M634.5,31.2969 C634.5,41.2969 652.5,41.2969 652.5,41.2969 C652.5,41.2969 670.5,41.2969 670.5,31.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="607" y="851.4717">Anchor Link</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="639" y="867.7686">DB</text><path d="M634.5,881.0703 C634.5,871.0703 652.5,871.0703 652.5,871.0703 C652.5,871.0703 670.5,871.0703 670.5,881.0703 L670.5,907.0703 C670.5,917.0703 652.5,917.0703 652.5,917.0703 C652.5,917.0703 634.5,917.0703 634.5,907.0703 L634.5,881.0703 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M634.5,881.0703 C634.5,891.0703 652.5,891.0703 652.5,891.0703 C652.5,891.0703 670.5,891.0703 670.5,881.0703 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="708" y="68.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="715" y="88.5889">Outbox</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="708" y="838.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="715" y="858.4717">Outbox</text><rect fill="#FFFFFF" height="109.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="36.5" y="131.0234"/><rect fill="#FFFFFF" height="551.6563" style="stroke:#181818;stroke-width:1.0;" width="10" x="149.5" y="269.8203"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="346.5" y="457.6172"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="432.5" y="341.0859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="501" y="399.3516"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="560.5" y="581.2813"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="647.5" y="639.5469"/><rect fill="#FFFFFF" height="94.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="736.5" y="697.8125"/><polygon fill="#181818" points="57.5,127.0234,47.5,131.0234,57.5,135.0234,53.5,131.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="51.5" x2="153.5" y1="131.0234" y2="131.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="63.5" y="125.9575">Subscribe</text><path d="M65,144.0234 L65,214.0234 L244,214.0234 L244,154.0234 L234,144.0234 L65,144.0234 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M234,144.0234 L234,154.0234 L244,154.0234 L234,144.0234 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="71" y="161.0903">On startup the handler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="71" y="176.2231">subscribes to the anchor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="71" y="191.356">linkset queue to receive</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="71" y="206.4888">linksets.</text><polygon fill="#181818" points="142.5,236.6875,152.5,240.6875,142.5,244.6875,146.5,240.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="41.5" x2="148.5" y1="240.6875" y2="240.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="48.5" y="235.6216">ok</text><polygon fill="#181818" points="137.5,265.8203,147.5,269.8203,137.5,273.8203,141.5,269.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="41.5" x2="143.5" y1="269.8203" y2="269.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="48.5" y="264.7544">anchorLinkset</text><line style="stroke:#181818;stroke-width:1.0;" x1="159.5" x2="201.5" y1="298.9531" y2="298.9531"/><line style="stroke:#181818;stroke-width:1.0;" x1="201.5" x2="201.5" y1="298.9531" y2="311.9531"/><line style="stroke:#181818;stroke-width:1.0;" x1="160.5" x2="201.5" y1="311.9531" y2="311.9531"/><polygon fill="#181818" points="170.5,307.9531,160.5,311.9531,170.5,315.9531,166.5,311.9531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="166.5" y="293.8872">Get VC from anchorLinkset</text><polygon fill="#181818" points="420.5,337.0859,430.5,341.0859,420.5,345.0859,424.5,341.0859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159.5" x2="426.5" y1="341.0859" y2="341.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="166.5" y="336.02">Put(vc)</text><polygon fill="#181818" points="170.5,366.2188,160.5,370.2188,170.5,374.2188,166.5,370.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="164.5" x2="436.5" y1="370.2188" y2="370.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="176.5" y="365.1528">ok</text><polygon fill="#181818" points="489,395.3516,499,399.3516,489,403.3516,493,399.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159.5" x2="495" y1="399.3516" y2="399.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="166.5" y="394.2856">Add(anchorLinkset)</text><polygon fill="#181818" points="170.5,424.4844,160.5,428.4844,170.5,432.4844,166.5,428.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="164.5" x2="505" y1="428.4844" y2="428.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="176.5" y="423.4185">ok</text><polygon fill="#181818" points="334.5,453.6172,344.5,457.6172,334.5,461.6172,338.5,457.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159.5" x2="340.5" y1="457.6172" y2="457.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="166.5" y="452.5513">Publish(anchorLinkset)</text><polygon fill="#181818" points="170.5,482.75,160.5,486.75,170.5,490.75,166.5,486.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="164.5" x2="350.5" y1="486.75" y2="486.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="176.5" y="481.6841">ok</text><path d="M46,499.75 L46,554.75 L262,554.75 L262,509.75 L252,499.75 L46,499.75 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M252,499.75 L252,509.75 L262,509.75 L252,499.75 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="52" y="516.8169">Delete transient data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="52" y="531.9497">i.e. witnesses and anchor links</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="52" y="547.0825">associated with the anchor</text><polygon fill="#181818" points="548.5,577.2813,558.5,581.2813,548.5,585.2813,552.5,581.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159.5" x2="554.5" y1="581.2813" y2="581.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="166.5" y="576.2153">Delete(anchor)</text><polygon fill="#181818" points="170.5,606.4141,160.5,610.4141,170.5,614.4141,166.5,610.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="164.5" x2="564.5" y1="610.4141" y2="610.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="176.5" y="605.3481">ok</text><polygon fill="#181818" points="635.5,635.5469,645.5,639.5469,635.5,643.5469,639.5,639.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159.5" x2="641.5" y1="639.5469" y2="639.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="166.5" y="634.481">Delete(anchor)</text><polygon fill="#181818" points="170.5,664.6797,160.5,668.6797,170.5,672.6797,166.5,668.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="164.5" x2="651.5" y1="668.6797" y2="668.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="176.5" y="663.6138">ok</text><polygon fill="#181818" points="724.5,693.8125,734.5,697.8125,724.5,701.8125,728.5,697.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="159.5" x2="730.5" y1="697.8125" y2="697.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="166.5" y="692.7466">Post(Create)</text><path d="M656,710.8125 L656,765.8125 L827,765.8125 L827,720.8125 L817,710.8125 L656,710.8125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M817,710.8125 L817,720.8125 L827,720.8125 L817,710.8125 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="662" y="727.8794">Post a Create activity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="662" y="743.0122">(containing the anchor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="662" y="758.145">linkset) to our followers</text><polygon fill="#181818" points="170.5,788.3438,160.5,792.3438,170.5,796.3438,166.5,792.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="164.5" x2="740.5" y1="792.3438" y2="792.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="176.5" y="787.2778">ok</text><polygon fill="#181818" points="52.5,817.4766,42.5,821.4766,52.5,825.4766,48.5,821.4766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46.5" x2="153.5" y1="821.4766" y2="821.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="58.5" y="816.4106">Ack</text><!--MD5=[791d08565e5815859e4953a236c4d3cc]
@startuml
'https://plantuml.com/sequence-diagram

queue "Anchor\nLinkset" as anchorLinksetQueue

participant "Anchor Linkset\nHandler" as anchorLinksetHandler
queue "Anchor" as anchorQueue

database "Verifiable\nCredential\nDB" as vcDB
database "CAS" as cas
database "Witness\nDB" as witnessDB
database "Anchor Link\nDB" as anchorLinkDB

participant "Outbox" as outbox

anchorLinksetHandler -> anchorLinksetQueue: Subscribe
note over anchorLinksetHandler
  On startup the handler
  subscribes to the anchor
  linkset queue to receive
  linksets.
end note
activate anchorLinksetQueue
  anchorLinksetQueue - -> anchorLinksetHandler: ok
deactivate anchorLinksetQueue

anchorLinksetQueue -> anchorLinksetHandler: anchorLinkset

activate anchorLinksetHandler
  anchorLinksetHandler -> anchorLinksetHandler: Get VC from anchorLinkset

  anchorLinksetHandler -> vcDB: Put(vc)
  activate vcDB
  vcDB - -> anchorLinksetHandler: ok
  deactivate vcDB

  anchorLinksetHandler -> cas: Add(anchorLinkset)
  activate cas
    cas - -> anchorLinksetHandler: ok
  deactivate cas

  anchorLinksetHandler -> anchorQueue: Publish(anchorLinkset)
  activate anchorQueue
    anchorQueue - -> anchorLinksetHandler: ok
  deactivate anchorQueue

  note over anchorLinksetHandler
     Delete transient data
     i.e. witnesses and anchor links
     associated with the anchor
  end note

  anchorLinksetHandler -> witnessDB: Delete(anchor)
  activate witnessDB
    witnessDB - -> anchorLinksetHandler: ok
  deactivate witnessDB

  anchorLinksetHandler -> anchorLinkDB: Delete(anchor)
  activate anchorLinkDB
    anchorLinkDB - -> anchorLinksetHandler: ok
  deactivate anchorLinkDB

  anchorLinksetHandler -> outbox: Post(Create)

  activate outbox
  note over outbox
     Post a Create activity
     (containing the anchor
     linkset) to our followers
  end note

  outbox - -> anchorLinksetHandler: ok
  deactivate outbox

  anchorLinksetHandler - -> anchorLinksetQueue: Ack
deactivate anchorLinksetHandler
@enduml

@startuml

queue "Anchor\nLinkset" as anchorLinksetQueue

participant "Anchor Linkset\nHandler" as anchorLinksetHandler
queue "Anchor" as anchorQueue

database "Verifiable\nCredential\nDB" as vcDB
database "CAS" as cas
database "Witness\nDB" as witnessDB
database "Anchor Link\nDB" as anchorLinkDB

participant "Outbox" as outbox

anchorLinksetHandler -> anchorLinksetQueue: Subscribe
note over anchorLinksetHandler
  On startup the handler
  subscribes to the anchor
  linkset queue to receive
  linksets.
end note
activate anchorLinksetQueue
  anchorLinksetQueue - -> anchorLinksetHandler: ok
deactivate anchorLinksetQueue

anchorLinksetQueue -> anchorLinksetHandler: anchorLinkset

activate anchorLinksetHandler
  anchorLinksetHandler -> anchorLinksetHandler: Get VC from anchorLinkset

  anchorLinksetHandler -> vcDB: Put(vc)
  activate vcDB
  vcDB - -> anchorLinksetHandler: ok
  deactivate vcDB

  anchorLinksetHandler -> cas: Add(anchorLinkset)
  activate cas
    cas - -> anchorLinksetHandler: ok
  deactivate cas

  anchorLinksetHandler -> anchorQueue: Publish(anchorLinkset)
  activate anchorQueue
    anchorQueue - -> anchorLinksetHandler: ok
  deactivate anchorQueue

  note over anchorLinksetHandler
     Delete transient data
     i.e. witnesses and anchor links
     associated with the anchor
  end note

  anchorLinksetHandler -> witnessDB: Delete(anchor)
  activate witnessDB
    witnessDB - -> anchorLinksetHandler: ok
  deactivate witnessDB

  anchorLinksetHandler -> anchorLinkDB: Delete(anchor)
  activate anchorLinkDB
    anchorLinkDB - -> anchorLinksetHandler: ok
  deactivate anchorLinkDB

  anchorLinksetHandler -> outbox: Post(Create)

  activate outbox
  note over outbox
     Post a Create activity
     (containing the anchor
     linkset) to our followers
  end note

  outbox - -> anchorLinksetHandler: ok
  deactivate outbox

  anchorLinksetHandler - -> anchorLinksetQueue: Ack
deactivate anchorLinksetHandler
@enduml

PlantUML version 1.2022.4beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>