<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1015px" preserveAspectRatio="none" style="width:924px;height:1015px;background:#FFFFFF;" version="1.1" viewBox="0 0 924 1015" width="924px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="109.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="77.5" y="131.0234"/><rect fill="#FFFFFF" height="617.0547" style="stroke:#181818;stroke-width:1.0;" width="10" x="226" y="269.8203"/><rect fill="#FFFFFF" height="94.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="423" y="457.6172"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="523" y="341.0859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="591.5" y="399.3516"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="651" y="646.6797"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="738" y="704.9453"/><rect fill="#FFFFFF" height="94.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="827" y="763.2109"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="82" x2="82" y1="99.8906" y2="904.875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="231" x2="231" y1="99.8906" y2="904.875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="427.5" x2="427.5" y1="99.8906" y2="904.875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="527.5" x2="527.5" y1="99.8906" y2="904.875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="596.5" x2="596.5" y1="99.8906" y2="904.875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="655.5" x2="655.5" y1="99.8906" y2="904.875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="742.5" x2="742.5" y1="99.8906" y2="904.875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="831.5" x2="831.5" y1="99.8906" y2="904.875"/><path d="M10,73.5938 L155,73.5938 C160,73.5938 160,86.7422 160,86.7422 C160,86.7422 160,99.8906 155,99.8906 L10,99.8906 C5,99.8906 5,86.7422 5,86.7422 C5,86.7422 5,73.5938 10,73.5938 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M155,73.5938 C150,73.5938 150,86.7422 150,86.7422 C150,99.8906 155,99.8906 155,99.8906 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="10" y="91.5889">orb.anchor_linkset</text><path d="M10,903.875 L155,903.875 C160,903.875 160,917.0234 160,917.0234 C160,917.0234 160,930.1719 155,930.1719 L10,930.1719 C5,930.1719 5,917.0234 5,917.0234 C5,917.0234 5,903.875 10,903.875 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M155,903.875 C150,903.875 150,917.0234 150,917.0234 C150,930.1719 155,930.1719 155,930.1719 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135" x="10" y="921.8701">orb.anchor_linkset</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="170" y="52.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="177" y="72.292">Anchor Linkset</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="203.5" y="88.5889">Handler</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="170" y="903.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="177" y="923.8701">Anchor Linkset</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="203.5" y="940.167">Handler</text><path d="M383.5,73.5938 L472.5,73.5938 C477.5,73.5938 477.5,86.7422 477.5,86.7422 C477.5,86.7422 477.5,99.8906 472.5,99.8906 L383.5,99.8906 C378.5,99.8906 378.5,86.7422 378.5,86.7422 C378.5,86.7422 378.5,73.5938 383.5,73.5938 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M472.5,73.5938 C467.5,73.5938 467.5,86.7422 467.5,86.7422 C467.5,99.8906 472.5,99.8906 472.5,99.8906 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="383.5" y="91.5889">orb.anchor</text><path d="M383.5,903.875 L472.5,903.875 C477.5,903.875 477.5,917.0234 477.5,917.0234 C477.5,917.0234 477.5,930.1719 472.5,930.1719 L383.5,930.1719 C378.5,930.1719 378.5,917.0234 378.5,917.0234 C378.5,917.0234 378.5,903.875 383.5,903.875 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M472.5,903.875 C467.5,903.875 467.5,917.0234 467.5,917.0234 C467.5,930.1719 472.5,930.1719 472.5,930.1719 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="383.5" y="921.8701">orb.anchor</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="490" y="63.9951">Verifiable</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="487.5" y="80.292">Credential</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="514.5" y="96.5889">DB</text><path d="M510,15 C510,5 528,5 528,5 C528,5 546,5 546,15 L546,41 C546,51 528,51 528,51 C528,51 510,51 510,41 L510,15 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M510,15 C510,25 528,25 528,25 C528,25 546,25 546,15 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="490" y="916.8701">Verifiable</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="487.5" y="933.167">Credential</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="514.5" y="949.4639">DB</text><path d="M510,962.7656 C510,952.7656 528,952.7656 528,952.7656 C528,952.7656 546,952.7656 546,962.7656 L546,988.7656 C546,998.7656 528,998.7656 528,998.7656 C528,998.7656 510,998.7656 510,988.7656 L510,962.7656 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M510,962.7656 C510,972.7656 528,972.7656 528,972.7656 C528,972.7656 546,972.7656 546,962.7656 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="579" y="96.5889">CAS</text><path d="M578.5,47.5938 C578.5,37.5938 596.5,37.5938 596.5,37.5938 C596.5,37.5938 614.5,37.5938 614.5,47.5938 L614.5,73.5938 C614.5,83.5938 596.5,83.5938 596.5,83.5938 C596.5,83.5938 578.5,83.5938 578.5,73.5938 L578.5,47.5938 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M578.5,47.5938 C578.5,57.5938 596.5,57.5938 596.5,57.5938 C596.5,57.5938 614.5,57.5938 614.5,47.5938 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="579" y="916.8701">CAS</text><path d="M578.5,930.1719 C578.5,920.1719 596.5,920.1719 596.5,920.1719 C596.5,920.1719 614.5,920.1719 614.5,930.1719 L614.5,956.1719 C614.5,966.1719 596.5,966.1719 596.5,966.1719 C596.5,966.1719 578.5,966.1719 578.5,956.1719 L578.5,930.1719 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M578.5,930.1719 C578.5,940.1719 596.5,940.1719 596.5,940.1719 C596.5,940.1719 614.5,940.1719 614.5,930.1719 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="624.5" y="80.292">Witness</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="642.5" y="96.5889">DB</text><path d="M638,31.2969 C638,21.2969 656,21.2969 656,21.2969 C656,21.2969 674,21.2969 674,31.2969 L674,57.2969 C674,67.2969 656,67.2969 656,67.2969 C656,67.2969 638,67.2969 638,57.2969 L638,31.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M638,31.2969 C638,41.2969 656,41.2969 656,41.2969 C656,41.2969 674,41.2969 674,31.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="624.5" y="916.8701">Witness</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="642.5" y="933.167">DB</text><path d="M638,946.4688 C638,936.4688 656,936.4688 656,936.4688 C656,936.4688 674,936.4688 674,946.4688 L674,972.4688 C674,982.4688 656,982.4688 656,982.4688 C656,982.4688 638,982.4688 638,972.4688 L638,946.4688 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M638,946.4688 C638,956.4688 656,956.4688 656,956.4688 C656,956.4688 674,956.4688 674,946.4688 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="697.5" y="80.292">Anchor Link</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="729.5" y="96.5889">DB</text><path d="M725,31.2969 C725,21.2969 743,21.2969 743,21.2969 C743,21.2969 761,21.2969 761,31.2969 L761,57.2969 C761,67.2969 743,67.2969 743,67.2969 C743,67.2969 725,67.2969 725,57.2969 L725,31.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M725,31.2969 C725,41.2969 743,41.2969 743,41.2969 C743,41.2969 761,41.2969 761,31.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="697.5" y="916.8701">Anchor Link</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="729.5" y="933.167">DB</text><path d="M725,946.4688 C725,936.4688 743,936.4688 743,936.4688 C743,936.4688 761,936.4688 761,946.4688 L761,972.4688 C761,982.4688 743,982.4688 743,982.4688 C743,982.4688 725,982.4688 725,972.4688 L725,946.4688 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M725,946.4688 C725,956.4688 743,956.4688 743,956.4688 C743,956.4688 761,956.4688 761,946.4688 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="798.5" y="68.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="805.5" y="88.5889">Outbox</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="798.5" y="903.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="805.5" y="923.8701">Outbox</text><rect fill="#FFFFFF" height="109.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="77.5" y="131.0234"/><rect fill="#FFFFFF" height="617.0547" style="stroke:#181818;stroke-width:1.0;" width="10" x="226" y="269.8203"/><rect fill="#FFFFFF" height="94.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="423" y="457.6172"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="523" y="341.0859"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="591.5" y="399.3516"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="651" y="646.6797"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="738" y="704.9453"/><rect fill="#FFFFFF" height="94.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="827" y="763.2109"/><polygon fill="#181818" points="98.5,127.0234,88.5,131.0234,98.5,135.0234,94.5,131.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="92.5" x2="230" y1="131.0234" y2="131.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="104.5" y="125.9575">Subscribe</text><path d="M141,144.0234 L141,214.0234 L320,214.0234 L320,154.0234 L310,144.0234 L141,144.0234 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M310,144.0234 L310,154.0234 L320,154.0234 L310,144.0234 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="147" y="161.0903">On startup the handler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="147" y="176.2231">subscribes to the anchor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="147" y="191.356">linkset queue to receive</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="147" y="206.4888">linksets.</text><polygon fill="#181818" points="219,236.6875,229,240.6875,219,244.6875,223,240.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="82.5" x2="225" y1="240.6875" y2="240.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="89.5" y="235.6216">ok</text><polygon fill="#181818" points="214,265.8203,224,269.8203,214,273.8203,218,269.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="82.5" x2="220" y1="269.8203" y2="269.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="89.5" y="264.7544">anchorLinkset</text><line style="stroke:#181818;stroke-width:1.0;" x1="236" x2="278" y1="298.9531" y2="298.9531"/><line style="stroke:#181818;stroke-width:1.0;" x1="278" x2="278" y1="298.9531" y2="311.9531"/><line style="stroke:#181818;stroke-width:1.0;" x1="237" x2="278" y1="311.9531" y2="311.9531"/><polygon fill="#181818" points="247,307.9531,237,311.9531,247,315.9531,243,311.9531" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="243" y="293.8872">Get VC from anchorLinkset</text><polygon fill="#181818" points="511,337.0859,521,341.0859,511,345.0859,515,341.0859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="236" x2="517" y1="341.0859" y2="341.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="243" y="336.02">Put(vc)</text><polygon fill="#181818" points="247,366.2188,237,370.2188,247,374.2188,243,370.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="241" x2="527" y1="370.2188" y2="370.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="253" y="365.1528">ok</text><polygon fill="#181818" points="579.5,395.3516,589.5,399.3516,579.5,403.3516,583.5,399.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="236" x2="585.5" y1="399.3516" y2="399.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="243" y="394.2856">Add(anchorLinkset)</text><polygon fill="#181818" points="247,424.4844,237,428.4844,247,432.4844,243,428.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="241" x2="595.5" y1="428.4844" y2="428.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="253" y="423.4185">ok</text><polygon fill="#181818" points="411,453.6172,421,457.6172,411,461.6172,415,457.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="236" x2="417" y1="457.6172" y2="457.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="243" y="452.5513">Publish(anchorInfo)</text><path d="M135,470.6172 L135,525.6172 L326,525.6172 L326,480.6172 L316,470.6172 L135,470.6172 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M316,470.6172 L316,480.6172 L326,480.6172 L316,470.6172 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="141" y="487.6841">The hashlink of the anchor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="141" y="502.8169">linkset is published to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="141" y="517.9497">anchor queue.</text><polygon fill="#181818" points="247,548.1484,237,552.1484,247,556.1484,243,552.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="241" x2="427" y1="552.1484" y2="552.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="253" y="547.0825">ok</text><path d="M123,565.1484 L123,620.1484 L339,620.1484 L339,575.1484 L329,565.1484 L123,565.1484 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M329,565.1484 L329,575.1484 L339,575.1484 L329,565.1484 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="129" y="582.2153">Delete transient data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="129" y="597.3481">i.e. witnesses and anchor links</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="129" y="612.481">associated with the anchor</text><polygon fill="#181818" points="639,642.6797,649,646.6797,639,650.6797,643,646.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="236" x2="645" y1="646.6797" y2="646.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="243" y="641.6138">Delete(anchor)</text><polygon fill="#181818" points="247,671.8125,237,675.8125,247,679.8125,243,675.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="241" x2="655" y1="675.8125" y2="675.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="253" y="670.7466">ok</text><polygon fill="#181818" points="726,700.9453,736,704.9453,726,708.9453,730,704.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="236" x2="732" y1="704.9453" y2="704.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="243" y="699.8794">Delete(anchor)</text><polygon fill="#181818" points="247,730.0781,237,734.0781,247,738.0781,243,734.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="241" x2="742" y1="734.0781" y2="734.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="253" y="729.0122">ok</text><polygon fill="#181818" points="815,759.2109,825,763.2109,815,767.2109,819,763.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="236" x2="821" y1="763.2109" y2="763.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="243" y="758.145">Post(Create)</text><path d="M746,776.2109 L746,831.2109 L917,831.2109 L917,786.2109 L907,776.2109 L746,776.2109 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M907,776.2109 L907,786.2109 L917,786.2109 L907,776.2109 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="752" y="793.2778">Post a Create activity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="752" y="808.4106">(containing the anchor</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="752" y="823.5435">linkset) to our followers</text><polygon fill="#181818" points="247,853.7422,237,857.7422,247,861.7422,243,857.7422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="241" x2="831" y1="857.7422" y2="857.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="253" y="852.6763">ok</text><polygon fill="#181818" points="93.5,882.875,83.5,886.875,93.5,890.875,89.5,886.875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="87.5" x2="230" y1="886.875" y2="886.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="99.5" y="881.8091">Ack</text><!--MD5=[2c2ba0183ce28af1adad1be38a4cf457]
@startuml
'https://plantuml.com/sequence-diagram

queue "orb.anchor_linkset" as anchorLinksetQueue

participant "Anchor Linkset\nHandler" as anchorLinksetHandler
queue "orb.anchor" as anchorQueue

database "Verifiable\nCredential\nDB" as vcDB
database "CAS" as cas
database "Witness\nDB" as witnessDB
database "Anchor Link\nDB" as anchorLinkDB

participant "Outbox" as outbox

anchorLinksetHandler -> anchorLinksetQueue: Subscribe
note over anchorLinksetHandler
  On startup the handler
  subscribes to the anchor
  linkset queue to receive
  linksets.
end note
activate anchorLinksetQueue
  anchorLinksetQueue - -> anchorLinksetHandler: ok
deactivate anchorLinksetQueue

anchorLinksetQueue -> anchorLinksetHandler: anchorLinkset

activate anchorLinksetHandler
  anchorLinksetHandler -> anchorLinksetHandler: Get VC from anchorLinkset

  anchorLinksetHandler -> vcDB: Put(vc)
  activate vcDB
  vcDB - -> anchorLinksetHandler: ok
  deactivate vcDB

  anchorLinksetHandler -> cas: Add(anchorLinkset)
  activate cas
    cas - -> anchorLinksetHandler: ok
  deactivate cas

  anchorLinksetHandler -> anchorQueue: Publish(anchorInfo)
  activate anchorQueue
    note over anchorLinksetHandler
      The hashlink of the anchor
      linkset is published to the
      anchor queue.
    end note
    anchorQueue - -> anchorLinksetHandler: ok
  deactivate anchorQueue

  note over anchorLinksetHandler
     Delete transient data
     i.e. witnesses and anchor links
     associated with the anchor
  end note

  anchorLinksetHandler -> witnessDB: Delete(anchor)
  activate witnessDB
    witnessDB - -> anchorLinksetHandler: ok
  deactivate witnessDB

  anchorLinksetHandler -> anchorLinkDB: Delete(anchor)
  activate anchorLinkDB
    anchorLinkDB - -> anchorLinksetHandler: ok
  deactivate anchorLinkDB

  anchorLinksetHandler -> outbox: Post(Create)

  activate outbox
  note over outbox
     Post a Create activity
     (containing the anchor
     linkset) to our followers
  end note

  outbox - -> anchorLinksetHandler: ok
  deactivate outbox

  anchorLinksetHandler - -> anchorLinksetQueue: Ack
deactivate anchorLinksetHandler
@enduml

@startuml

queue "orb.anchor_linkset" as anchorLinksetQueue

participant "Anchor Linkset\nHandler" as anchorLinksetHandler
queue "orb.anchor" as anchorQueue

database "Verifiable\nCredential\nDB" as vcDB
database "CAS" as cas
database "Witness\nDB" as witnessDB
database "Anchor Link\nDB" as anchorLinkDB

participant "Outbox" as outbox

anchorLinksetHandler -> anchorLinksetQueue: Subscribe
note over anchorLinksetHandler
  On startup the handler
  subscribes to the anchor
  linkset queue to receive
  linksets.
end note
activate anchorLinksetQueue
  anchorLinksetQueue - -> anchorLinksetHandler: ok
deactivate anchorLinksetQueue

anchorLinksetQueue -> anchorLinksetHandler: anchorLinkset

activate anchorLinksetHandler
  anchorLinksetHandler -> anchorLinksetHandler: Get VC from anchorLinkset

  anchorLinksetHandler -> vcDB: Put(vc)
  activate vcDB
  vcDB - -> anchorLinksetHandler: ok
  deactivate vcDB

  anchorLinksetHandler -> cas: Add(anchorLinkset)
  activate cas
    cas - -> anchorLinksetHandler: ok
  deactivate cas

  anchorLinksetHandler -> anchorQueue: Publish(anchorInfo)
  activate anchorQueue
    note over anchorLinksetHandler
      The hashlink of the anchor
      linkset is published to the
      anchor queue.
    end note
    anchorQueue - -> anchorLinksetHandler: ok
  deactivate anchorQueue

  note over anchorLinksetHandler
     Delete transient data
     i.e. witnesses and anchor links
     associated with the anchor
  end note

  anchorLinksetHandler -> witnessDB: Delete(anchor)
  activate witnessDB
    witnessDB - -> anchorLinksetHandler: ok
  deactivate witnessDB

  anchorLinksetHandler -> anchorLinkDB: Delete(anchor)
  activate anchorLinkDB
    anchorLinkDB - -> anchorLinksetHandler: ok
  deactivate anchorLinkDB

  anchorLinksetHandler -> outbox: Post(Create)

  activate outbox
  note over outbox
     Post a Create activity
     (containing the anchor
     linkset) to our followers
  end note

  outbox - -> anchorLinksetHandler: ok
  deactivate outbox

  anchorLinksetHandler - -> anchorLinksetQueue: Ack
deactivate anchorLinksetHandler
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>