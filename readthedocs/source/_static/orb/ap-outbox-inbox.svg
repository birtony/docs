<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2072px" preserveAspectRatio="none" style="width:1048px;height:2072px;background:#FFFFFF;" version="1.1" viewBox="0 0 1048 2072" width="1048px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="2060.1641" style="stroke:#181818;stroke-width:0.5;" width="651.5" x="1" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66" x="291.25" y="18.0669">Domain1</text><rect fill="#DDDDDD" height="2060.1641" style="stroke:#181818;stroke-width:0.5;" width="387.5" x="654.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="68" x="814.25" y="18.0669">DomainN</text><rect fill="#FFFFFF" height="100.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="152.5" y="148.8594"/><rect fill="#FFFFFF" height="729.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="152.5" y="278.3906"/><rect fill="#FFFFFF" height="436.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="152.5" y="1037.1172"/><rect fill="#FFFFFF" height="241.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="152.5" y="1494.3125"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="284.5" y="534.8516"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="284.5" y="1066.25"/><rect fill="#FFFFFF" height="1515.5156" style="stroke:#181818;stroke-width:1.0;" width="10" x="414.5" y="220.125"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="534" y="307.5234"/><rect fill="#FFFFFF" height="109.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="608.5" y="365.7891"/><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="680.5" y="1523.4453"/><rect fill="#FFFFFF" height="196.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="680.5" y="1764.7734"/><rect fill="#FFFFFF" height="399.9922" style="stroke:#181818;stroke-width:1.0;" width="10" x="822.5" y="1552.5781"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="930" y="1793.9063"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="998" y="1894.3047"/><rect height="400.8672" style="stroke:#000000;stroke-width:1.5;fill:none;" width="458" x="104" y="578.9844"/><rect height="369.7344" style="stroke:#000000;stroke-width:1.5;fill:none;" width="438" x="114" y="603.1172"/><rect height="355.7969" style="stroke:#000000;stroke-width:1.5;fill:none;" width="474" x="104" y="1110.3828"/><rect height="324.6641" style="stroke:#000000;stroke-width:1.5;fill:none;" width="454" x="114" y="1134.5156"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="48" x2="48" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="157" x2="157" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="289.5" x2="289.5" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="419.5" x2="419.5" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="538.5" x2="538.5" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="613.5" x2="613.5" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="685.5" x2="685.5" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="827" x2="827" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="935" x2="935" y1="117.7266" y2="1970.5703"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1003" x2="1003" y1="117.7266" y2="1970.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="9.5" y="98.1279">Service or</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="5" y="114.4248">Admin User</text><ellipse cx="48.5" cy="33.6328" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M48.5,41.6328 L48.5,68.6328 M35.5,49.6328 L61.5,49.6328 M48.5,68.6328 L35.5,83.6328 M48.5,68.6328 L61.5,83.6328 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="9.5" y="1982.5654">Service or</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="5" y="1998.8623">Admin User</text><ellipse cx="48.5" cy="2010.6641" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M48.5,2018.6641 L48.5,2045.6641 M35.5,2026.6641 L61.5,2026.6641 M48.5,2045.6641 L35.5,2060.6641 M48.5,2045.6641 L61.5,2060.6641 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="124" y="86.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="131" y="106.4248">Outbox</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67" x="124" y="1969.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="131" y="1989.5654">Outbox</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="76" x="251.5" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="269.5" y="90.1279">Inbox</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="258.5" y="106.4248">Resolver</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="76" x="251.5" y="1969.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="269.5" y="1989.5654">Inbox</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="258.5" y="2005.8623">Resolver</text><path d="M344.5,91.4297 L494.5,91.4297 C499.5,91.4297 499.5,104.5781 499.5,104.5781 C499.5,104.5781 499.5,117.7266 494.5,117.7266 L344.5,117.7266 C339.5,117.7266 339.5,104.5781 339.5,104.5781 C339.5,104.5781 339.5,91.4297 344.5,91.4297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M494.5,91.4297 C489.5,91.4297 489.5,104.5781 489.5,104.5781 C489.5,117.7266 494.5,117.7266 494.5,117.7266 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="344.5" y="109.4248">orb.activity.outbox</text><path d="M344.5,1969.5703 L494.5,1969.5703 C499.5,1969.5703 499.5,1982.7188 499.5,1982.7188 C499.5,1982.7188 499.5,1995.8672 494.5,1995.8672 L344.5,1995.8672 C339.5,1995.8672 339.5,1982.7188 339.5,1982.7188 C339.5,1982.7188 339.5,1969.5703 344.5,1969.5703 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M494.5,1969.5703 C489.5,1969.5703 489.5,1982.7188 489.5,1982.7188 C489.5,1995.8672 494.5,1995.8672 494.5,1995.8672 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="344.5" y="1987.5654">orb.activity.outbox</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="509.5" y="98.1279">Outbox</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="525.5" y="114.4248">DB</text><path d="M521,49.1328 C521,39.1328 539,39.1328 539,39.1328 C539,39.1328 557,39.1328 557,49.1328 L557,75.1328 C557,85.1328 539,85.1328 539,85.1328 C539,85.1328 521,85.1328 521,75.1328 L521,49.1328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M521,49.1328 C521,59.1328 539,59.1328 539,59.1328 C539,59.1328 557,59.1328 557,49.1328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="509.5" y="1982.5654">Outbox</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="525.5" y="1998.8623">DB</text><path d="M521,2012.1641 C521,2002.1641 539,2002.1641 539,2002.1641 C539,2002.1641 557,2002.1641 557,2012.1641 L557,2038.1641 C557,2048.1641 539,2048.1641 539,2048.1641 C539,2048.1641 521,2048.1641 521,2038.1641 L521,2012.1641 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M521,2012.1641 C521,2022.1641 539,2022.1641 539,2022.1641 C539,2022.1641 557,2022.1641 557,2012.1641 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70" x="578.5" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="585.5" y="90.1279">Activity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="586" y="106.4248">Handler</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70" x="578.5" y="1969.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="585.5" y="1989.5654">Activity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="586" y="2005.8623">Handler</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="658.5" y="86.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="665.5" y="106.4248">Inbox</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="658.5" y="1969.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="665.5" y="1989.5654">Inbox</text><path d="M758,91.4297 L897,91.4297 C902,91.4297 902,104.5781 902,104.5781 C902,104.5781 902,117.7266 897,117.7266 L758,117.7266 C753,117.7266 753,104.5781 753,104.5781 C753,104.5781 753,91.4297 758,91.4297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M897,91.4297 C892,91.4297 892,104.5781 892,104.5781 C892,117.7266 897,117.7266 897,117.7266 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="758" y="109.4248">orb.activity.inbox</text><path d="M758,1969.5703 L897,1969.5703 C902,1969.5703 902,1982.7188 902,1982.7188 C902,1982.7188 902,1995.8672 897,1995.8672 L758,1995.8672 C753,1995.8672 753,1982.7188 753,1982.7188 C753,1982.7188 753,1969.5703 758,1969.5703 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M897,1969.5703 C892,1969.5703 892,1982.7188 892,1982.7188 C892,1995.8672 897,1995.8672 897,1995.8672 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="758" y="1987.5654">orb.activity.inbox</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="912" y="98.1279">Inbox</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="921.5" y="114.4248">DB</text><path d="M917,49.1328 C917,39.1328 935,39.1328 935,39.1328 C935,39.1328 953,39.1328 953,49.1328 L953,75.1328 C953,85.1328 935,85.1328 935,85.1328 C935,85.1328 917,85.1328 917,75.1328 L917,49.1328 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M917,49.1328 C917,59.1328 935,59.1328 935,59.1328 C935,59.1328 953,59.1328 953,49.1328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="912" y="1982.5654">Inbox</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21" x="921.5" y="1998.8623">DB</text><path d="M917,2012.1641 C917,2002.1641 935,2002.1641 935,2002.1641 C935,2002.1641 953,2002.1641 953,2012.1641 L953,2038.1641 C953,2048.1641 935,2048.1641 935,2048.1641 C935,2048.1641 917,2048.1641 917,2038.1641 L917,2012.1641 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M917,2012.1641 C917,2022.1641 935,2022.1641 935,2022.1641 C935,2022.1641 953,2022.1641 953,2012.1641 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70" x="968" y="70.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="975" y="90.1279">Activity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="975.5" y="106.4248">Handler</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70" x="968" y="1969.5703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="975" y="1989.5654">Activity</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="975.5" y="2005.8623">Handler</text><rect fill="#FFFFFF" height="100.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="152.5" y="148.8594"/><rect fill="#FFFFFF" height="729.5938" style="stroke:#181818;stroke-width:1.0;" width="10" x="152.5" y="278.3906"/><rect fill="#FFFFFF" height="436.0625" style="stroke:#181818;stroke-width:1.0;" width="10" x="152.5" y="1037.1172"/><rect fill="#FFFFFF" height="241.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="152.5" y="1494.3125"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="284.5" y="534.8516"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="284.5" y="1066.25"/><rect fill="#FFFFFF" height="1515.5156" style="stroke:#181818;stroke-width:1.0;" width="10" x="414.5" y="220.125"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="534" y="307.5234"/><rect fill="#FFFFFF" height="109.6641" style="stroke:#181818;stroke-width:1.0;" width="10" x="608.5" y="365.7891"/><rect fill="#FFFFFF" height="87.3984" style="stroke:#181818;stroke-width:1.0;" width="10" x="680.5" y="1523.4453"/><rect fill="#FFFFFF" height="196.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="680.5" y="1764.7734"/><rect fill="#FFFFFF" height="399.9922" style="stroke:#181818;stroke-width:1.0;" width="10" x="822.5" y="1552.5781"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="930" y="1793.9063"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="998" y="1894.3047"/><polygon fill="#181818" points="140.5,144.8594,150.5,148.8594,140.5,152.8594,144.5,148.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="48.5" x2="146.5" y1="148.8594" y2="148.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="55.5" y="143.7935">Post(activity)</text><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="204.5" y1="177.9922" y2="177.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="204.5" x2="204.5" y1="177.9922" y2="190.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="163.5" x2="204.5" y1="190.9922" y2="190.9922"/><polygon fill="#181818" points="173.5,186.9922,163.5,190.9922,173.5,194.9922,169.5,190.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="169.5" y="172.9263">validate(activity)</text><polygon fill="#181818" points="402.5,216.125,412.5,220.125,402.5,224.125,406.5,220.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="408.5" y1="220.125" y2="220.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="169.5" y="215.0591">Publish("broadcast",activity)</text><polygon fill="#181818" points="168.5,245.2578,158.5,249.2578,168.5,253.2578,164.5,249.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="162.5" x2="413.5" y1="249.2578" y2="249.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="174.5" y="244.1919">ok</text><polygon fill="#181818" points="173.5,274.3906,163.5,278.3906,173.5,282.3906,169.5,278.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="167.5" x2="413.5" y1="278.3906" y2="278.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="179.5" y="273.3247">("broadcast",activity)</text><polygon fill="#181818" points="522,303.5234,532,307.5234,522,311.5234,526,307.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="528" y1="307.5234" y2="307.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="169.5" y="302.4575">Put(activity)</text><polygon fill="#181818" points="173.5,332.6563,163.5,336.6563,173.5,340.6563,169.5,336.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167.5" x2="538" y1="336.6563" y2="336.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="179.5" y="331.5903">ok</text><polygon fill="#181818" points="596.5,361.7891,606.5,365.7891,596.5,369.7891,600.5,365.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="602.5" y1="365.7891" y2="365.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="169.5" y="360.7231">activity</text><path d="M525,378.7891 L525,448.7891 L701,448.7891 L701,388.7891 L691,378.7891 L525,378.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M691,378.7891 L691,388.7891 L701,388.7891 L691,378.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="531" y="395.856">The outbox handler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="531" y="410.9888">may perform additional</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="531" y="426.1216">steps, depending on the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="531" y="441.2544">activity type.</text><polygon fill="#181818" points="173.5,471.4531,163.5,475.4531,173.5,479.4531,169.5,475.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167.5" x2="612.5" y1="475.4531" y2="475.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="179.5" y="470.3872">ok</text><polygon fill="#181818" points="272.5,530.8516,282.5,534.8516,272.5,538.8516,276.5,534.8516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="278.5" y1="534.8516" y2="534.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="169.5" y="499.52">Resolve URI's</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="169.5" y="514.6528">in activity's</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="169.5" y="529.7856">"to" field</text><polygon fill="#181818" points="173.5,559.9844,163.5,563.9844,173.5,567.9844,169.5,563.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167.5" x2="288.5" y1="563.9844" y2="563.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="179.5" y="558.9185">results</text><path d="M104,578.9844 L182,578.9844 L182,586.1172 L172,596.1172 L104,596.1172 L104,578.9844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="400.8672" style="stroke:#000000;stroke-width:1.5;" width="458" x="104" y="578.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="119" y="592.0513">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="152" x="197" y="591.1948">[For resultN in results]</text><path d="M114,603.1172 L180,603.1172 L180,610.25 L170,620.25 L114,620.25 L114,603.1172 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="369.7344" style="stroke:#000000;stroke-width:1.5;" width="438" x="114" y="603.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="129" y="616.1841">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="136" x="195" y="615.3276">[No error in resultN]</text><path d="M305,625.25 L305,680.25 L534,680.25 L534,635.25 L524,625.25 L305,625.25 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M524,625.25 L524,635.25 L534,635.25 L524,625.25 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="311" y="642.3169">A "deliver" message is published</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="311" y="657.4497">to the queue in order to deliver</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="311" y="672.5825">the activity to the target URI.</text><polygon fill="#181818" points="402.5,702.7813,412.5,706.7813,402.5,710.7813,406.5,706.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="408.5" y1="706.7813" y2="706.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="169.5" y="701.7153">Publish("deliver",resultN.uri,activity)</text><polygon fill="#181818" points="173.5,731.9141,163.5,735.9141,173.5,739.9141,169.5,735.9141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167.5" x2="413.5" y1="735.9141" y2="735.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="179.5" y="730.8481">ok</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="114" x2="552" y1="744.9141" y2="744.9141"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="183" x="119" y="755.1245">[Transient error in resultN]</text><path d="M297,763.7188 L297,878.7188 L542,878.7188 L542,773.7188 L532,763.7188 L297,763.7188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M532,763.7188 L532,773.7188 L542,773.7188 L532,763.7188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="303" y="780.7856">A transient error occurred</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="303" y="795.9185">while attempting to resolve</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="303" y="811.0513">the inbox of the target URI.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="303" y="826.1841">A "resolve-and-deliver" message is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="303" y="841.3169">published to the queue so that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="303" y="856.4497">the resolve of the URI may</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="303" y="871.5825">be retried.</text><polygon fill="#181818" points="402.5,916.9141,412.5,920.9141,402.5,924.9141,406.5,920.9141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="408.5" y1="920.9141" y2="920.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="169.5" y="900.7153">Publish("resolve-and-deliver",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="169.5" y="915.8481">resultN.uri,activity)</text><polygon fill="#181818" points="173.5,946.0469,163.5,950.0469,173.5,954.0469,169.5,950.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167.5" x2="413.5" y1="950.0469" y2="950.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="179.5" y="944.981">ok</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="114" x2="552" y1="959.0469" y2="959.0469"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="351" x="119" y="969.2573">[Persistent error in resultN. The URI will be skipped.]</text><polygon fill="#181818" points="402.5,1003.9844,412.5,1007.9844,402.5,1011.9844,406.5,1007.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="157.5" x2="408.5" y1="1007.9844" y2="1007.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="164.5" y="1002.9185">ACK</text><polygon fill="#181818" points="173.5,1033.1172,163.5,1037.1172,173.5,1041.1172,169.5,1037.1172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="167.5" x2="413.5" y1="1037.1172" y2="1037.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="179.5" y="1032.0513">("resolve-and-deliver",uriN,activity)</text><polygon fill="#181818" points="272.5,1062.25,282.5,1066.25,272.5,1070.25,276.5,1066.25" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="278.5" y1="1066.25" y2="1066.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="169.5" y="1061.1841">Resolve uriN</text><polygon fill="#181818" points="173.5,1091.3828,163.5,1095.3828,173.5,1099.3828,169.5,1095.3828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167.5" x2="288.5" y1="1095.3828" y2="1095.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="179.5" y="1090.3169">results</text><path d="M104,1110.3828 L182,1110.3828 L182,1117.5156 L172,1127.5156 L104,1127.5156 L104,1110.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="355.7969" style="stroke:#000000;stroke-width:1.5;" width="474" x="104" y="1110.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="119" y="1123.4497">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="152" x="197" y="1122.5933">[For resultN in results]</text><path d="M114,1134.5156 L180,1134.5156 L180,1141.6484 L170,1151.6484 L114,1151.6484 L114,1134.5156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="324.6641" style="stroke:#000000;stroke-width:1.5;" width="454" x="114" y="1134.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="129" y="1147.5825">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="136" x="195" y="1146.7261">[No error in resultN]</text><path d="M305,1156.6484 L305,1211.6484 L534,1211.6484 L534,1166.6484 L524,1156.6484 L305,1156.6484 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M524,1156.6484 L524,1166.6484 L534,1166.6484 L524,1156.6484 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="311" y="1173.7153">A "deliver" message is published</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="311" y="1188.8481">to the queue in order to deliver</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="311" y="1203.981">the activity to the target URI.</text><polygon fill="#181818" points="402.5,1234.1797,412.5,1238.1797,402.5,1242.1797,406.5,1238.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="408.5" y1="1238.1797" y2="1238.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="169.5" y="1233.1138">Publish("deliver",resultN.uri,activity)</text><polygon fill="#181818" points="173.5,1263.3125,163.5,1267.3125,173.5,1271.3125,169.5,1267.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167.5" x2="413.5" y1="1267.3125" y2="1267.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="179.5" y="1262.2466">ok</text><polygon fill="#181818" points="402.5,1292.4453,412.5,1296.4453,402.5,1300.4453,406.5,1296.4453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="162.5" x2="408.5" y1="1296.4453" y2="1296.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="169.5" y="1291.3794">ACK</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="114" x2="568" y1="1305.4453" y2="1305.4453"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113" x="119" y="1315.6558">[Error in resultN]</text><path d="M280,1324.25 L280,1424.25 L558,1424.25 L558,1334.25 L548,1324.25 L280,1324.25 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M548,1324.25 L548,1334.25 L558,1334.25 L548,1324.25 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="286" y="1341.3169">An error occurred while attempting</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="286" y="1356.4497">to resolve the inbox(es) of the target</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="286" y="1371.5825">URI. A NACK is sent back to the queue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="286" y="1386.7153">so that the message may be retried</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="286" y="1401.8481">according to the backoff and retry limits</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="286" y="1416.981">of the Pub/Sub subsystem.</text><polygon fill="#181818" points="402.5,1447.1797,412.5,1451.1797,402.5,1455.1797,406.5,1451.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="162.5" x2="408.5" y1="1451.1797" y2="1451.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="169.5" y="1446.1138">NACK</text><polygon fill="#181818" points="173.5,1490.3125,163.5,1494.3125,173.5,1498.3125,169.5,1494.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="167.5" x2="413.5" y1="1494.3125" y2="1494.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="179.5" y="1489.2466">("deliver",uriN,activity)</text><polygon fill="#181818" points="668.5,1519.4453,678.5,1523.4453,668.5,1527.4453,672.5,1523.4453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="162.5" x2="674.5" y1="1523.4453" y2="1523.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="169.5" y="1518.3794">HTTP Post(uriN,activity)</text><polygon fill="#181818" points="810.5,1548.5781,820.5,1552.5781,810.5,1556.5781,814.5,1552.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="690.5" x2="816.5" y1="1552.5781" y2="1552.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="697.5" y="1547.5122">Publish(activity)</text><polygon fill="#181818" points="701.5,1577.7109,691.5,1581.7109,701.5,1585.7109,697.5,1581.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="695.5" x2="821.5" y1="1581.7109" y2="1581.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="707.5" y="1576.645">ok</text><polygon fill="#181818" points="173.5,1606.8438,163.5,1610.8438,173.5,1614.8438,169.5,1610.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="167.5" x2="684.5" y1="1610.8438" y2="1610.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="179.5" y="1605.7778">ok</text><path d="M54,1623.8438 L54,1708.8438 L260,1708.8438 L260,1633.8438 L250,1623.8438 L54,1623.8438 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M250,1623.8438 L250,1633.8438 L260,1633.8438 L250,1623.8438 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="60" y="1640.9106">If the HTTP response from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="60" y="1656.0435">the target URI is not OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="60" y="1671.1763">then a NACK is sent back to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="60" y="1686.3091">the queue and the target will</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="60" y="1701.4419">be retried.</text><polygon fill="#181818" points="407.5,1731.6406,417.5,1735.6406,407.5,1739.6406,411.5,1735.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="157.5" x2="413.5" y1="1735.6406" y2="1735.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="164.5" y="1730.5747">ACK</text><polygon fill="#181818" points="701.5,1760.7734,691.5,1764.7734,701.5,1768.7734,697.5,1764.7734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="695.5" x2="821.5" y1="1764.7734" y2="1764.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="707.5" y="1759.7075">activity</text><polygon fill="#181818" points="918,1789.9063,928,1793.9063,918,1797.9063,922,1793.9063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="690.5" x2="924" y1="1793.9063" y2="1793.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="697.5" y="1788.8403">Put(activity)</text><polygon fill="#181818" points="701.5,1819.0391,691.5,1823.0391,701.5,1827.0391,697.5,1823.0391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="695.5" x2="934" y1="1823.0391" y2="1823.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="707.5" y="1817.9731">ok</text><line style="stroke:#181818;stroke-width:1.0;" x1="690.5" x2="732.5" y1="1852.1719" y2="1852.1719"/><line style="stroke:#181818;stroke-width:1.0;" x1="732.5" x2="732.5" y1="1852.1719" y2="1865.1719"/><line style="stroke:#181818;stroke-width:1.0;" x1="691.5" x2="732.5" y1="1865.1719" y2="1865.1719"/><polygon fill="#181818" points="701.5,1861.1719,691.5,1865.1719,701.5,1869.1719,697.5,1865.1719" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="697.5" y="1847.106">Authorize(activity)</text><polygon fill="#181818" points="986,1890.3047,996,1894.3047,986,1898.3047,990,1894.3047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="690.5" x2="992" y1="1894.3047" y2="1894.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="697.5" y="1889.2388">Handle(activity)</text><polygon fill="#181818" points="701.5,1919.4375,691.5,1923.4375,701.5,1927.4375,697.5,1923.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="695.5" x2="1002" y1="1923.4375" y2="1923.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15" x="707.5" y="1918.3716">ok</text><polygon fill="#181818" points="815.5,1948.5703,825.5,1952.5703,815.5,1956.5703,819.5,1952.5703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="690.5" x2="821.5" y1="1952.5703" y2="1952.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="697.5" y="1947.5044">ACK</text><!--MD5=[7a931aaa13becbabcab5e66b77082955]
@startuml
'https://plantuml.com/sequence-diagram

box Domain1 #White
actor "Service or\nAdmin User" as adminUser
participant Outbox
participant "Inbox\nResolver" as resolver
queue "orb.activity.outbox" as outboxQueue
database "Outbox\nDB" as outboxDB
participant "Activity\nHandler" as outboxHandler
end box

box DomainN
participant Inbox
queue "orb.activity.inbox" as inboxQueue
database "Inbox\nDB" as inboxDB
participant "Activity\nHandler" as inboxHandler
end box

adminUser -> Outbox: Post(activity)

activate Outbox
  Outbox -> Outbox: validate(activity)
  Outbox -> outboxQueue: Publish("broadcast",activity)
  activate outboxQueue
    outboxQueue - -> Outbox: ok
deactivate Outbox

outboxQueue -> Outbox: ("broadcast",activity)

activate Outbox

Outbox -> outboxDB: Put(activity)
activate outboxDB
  outboxDB - -> Outbox: ok
deactivate outboxDB

Outbox -> outboxHandler: activity
activate outboxHandler
  note over outboxHandler
    The outbox handler
    may perform additional
    steps, depending on the
    activity type.
  end note
  outboxHandler - -> Outbox: ok
deactivate outboxHandler

Outbox -> resolver: Resolve URI's\nin activity's\n"to" field
activate resolver
resolver - -> Outbox: results
deactivate resolver

loop For resultN in results
  alt No error in resultN
    note over outboxQueue
      A "deliver" message is published
      to the queue in order to deliver
      the activity to the target URI.
    end note
    Outbox -> outboxQueue: Publish("deliver",resultN.uri,activity)
    outboxQueue - -> Outbox: ok
  else Transient error in resultN
    note over outboxQueue
      A transient error occurred
      while attempting to resolve
      the inbox of the target URI.
      A "resolve-and-deliver" message is
      published to the queue so that
      the resolve of the URI may
      be retried.
    end note
    Outbox -> outboxQueue: Publish("resolve-and-deliver",\nresultN.uri,activity)
    outboxQueue - -> Outbox: ok
  else Persistent error in resultN. The URI will be skipped.
  end alt
end loop

Outbox - -> outboxQueue: ACK

deactivate Outbox

deactivate Outbox

outboxQueue -> Outbox: ("resolve-and-deliver",uriN,activity)

activate Outbox

Outbox -> resolver: Resolve uriN
activate resolver
resolver - -> Outbox: results
deactivate resolver

loop For resultN in results
  alt No error in resultN
    note over outboxQueue
      A "deliver" message is published
      to the queue in order to deliver
      the activity to the target URI.
    end note
    Outbox -> outboxQueue: Publish("deliver",resultN.uri,activity)
    outboxQueue - -> Outbox: ok
    Outbox - -> outboxQueue: ACK
  else Error in resultN
    note over outboxQueue
      An error occurred while attempting
      to resolve the inbox(es) of the target
      URI. A NACK is sent back to the queue
      so that the message may be retried
      according to the backoff and retry limits
      of the Pub/Sub subsystem.
    end note
    Outbox - -> outboxQueue: NACK
  end alt
end loop

deactivate Outbox

outboxQueue -> Outbox: ("deliver",uriN,activity)

activate Outbox

Outbox -> Inbox: HTTP Post(uriN,activity)

activate Inbox

Inbox -> inboxQueue: Publish(activity)

activate inboxQueue

inboxQueue - -> Inbox: ok

Inbox - -> Outbox: ok

note over Outbox
 If the HTTP response from
 the target URI is not OK
 then a NACK is sent back to
 the queue and the target will
 be retried.
end note

deactivate Inbox

Outbox - -> outboxQueue: ACK

deactivate Outbox

deactivate outboxQueue

inboxQueue -> Inbox: activity

activate Inbox

Inbox -> inboxDB: Put(activity)

activate inboxDB
  inboxDB - -> Inbox: ok
deactivate inboxDB

Inbox -> Inbox: Authorize(activity)

Inbox -> inboxHandler: Handle(activity)

activate inboxHandler
inboxHandler - -> Inbox: ok
deactivate inboxHandler

Inbox - -> inboxQueue: ACK

deactivate inboxQueue
@enduml

@startuml

box Domain1 #White
actor "Service or\nAdmin User" as adminUser
participant Outbox
participant "Inbox\nResolver" as resolver
queue "orb.activity.outbox" as outboxQueue
database "Outbox\nDB" as outboxDB
participant "Activity\nHandler" as outboxHandler
end box

box DomainN
participant Inbox
queue "orb.activity.inbox" as inboxQueue
database "Inbox\nDB" as inboxDB
participant "Activity\nHandler" as inboxHandler
end box

adminUser -> Outbox: Post(activity)

activate Outbox
  Outbox -> Outbox: validate(activity)
  Outbox -> outboxQueue: Publish("broadcast",activity)
  activate outboxQueue
    outboxQueue - -> Outbox: ok
deactivate Outbox

outboxQueue -> Outbox: ("broadcast",activity)

activate Outbox

Outbox -> outboxDB: Put(activity)
activate outboxDB
  outboxDB - -> Outbox: ok
deactivate outboxDB

Outbox -> outboxHandler: activity
activate outboxHandler
  note over outboxHandler
    The outbox handler
    may perform additional
    steps, depending on the
    activity type.
  end note
  outboxHandler - -> Outbox: ok
deactivate outboxHandler

Outbox -> resolver: Resolve URI's\nin activity's\n"to" field
activate resolver
resolver - -> Outbox: results
deactivate resolver

loop For resultN in results
  alt No error in resultN
    note over outboxQueue
      A "deliver" message is published
      to the queue in order to deliver
      the activity to the target URI.
    end note
    Outbox -> outboxQueue: Publish("deliver",resultN.uri,activity)
    outboxQueue - -> Outbox: ok
  else Transient error in resultN
    note over outboxQueue
      A transient error occurred
      while attempting to resolve
      the inbox of the target URI.
      A "resolve-and-deliver" message is
      published to the queue so that
      the resolve of the URI may
      be retried.
    end note
    Outbox -> outboxQueue: Publish("resolve-and-deliver",\nresultN.uri,activity)
    outboxQueue - -> Outbox: ok
  else Persistent error in resultN. The URI will be skipped.
  end alt
end loop

Outbox - -> outboxQueue: ACK

deactivate Outbox

deactivate Outbox

outboxQueue -> Outbox: ("resolve-and-deliver",uriN,activity)

activate Outbox

Outbox -> resolver: Resolve uriN
activate resolver
resolver - -> Outbox: results
deactivate resolver

loop For resultN in results
  alt No error in resultN
    note over outboxQueue
      A "deliver" message is published
      to the queue in order to deliver
      the activity to the target URI.
    end note
    Outbox -> outboxQueue: Publish("deliver",resultN.uri,activity)
    outboxQueue - -> Outbox: ok
    Outbox - -> outboxQueue: ACK
  else Error in resultN
    note over outboxQueue
      An error occurred while attempting
      to resolve the inbox(es) of the target
      URI. A NACK is sent back to the queue
      so that the message may be retried
      according to the backoff and retry limits
      of the Pub/Sub subsystem.
    end note
    Outbox - -> outboxQueue: NACK
  end alt
end loop

deactivate Outbox

outboxQueue -> Outbox: ("deliver",uriN,activity)

activate Outbox

Outbox -> Inbox: HTTP Post(uriN,activity)

activate Inbox

Inbox -> inboxQueue: Publish(activity)

activate inboxQueue

inboxQueue - -> Inbox: ok

Inbox - -> Outbox: ok

note over Outbox
 If the HTTP response from
 the target URI is not OK
 then a NACK is sent back to
 the queue and the target will
 be retried.
end note

deactivate Inbox

Outbox - -> outboxQueue: ACK

deactivate Outbox

deactivate outboxQueue

inboxQueue -> Inbox: activity

activate Inbox

Inbox -> inboxDB: Put(activity)

activate inboxDB
  inboxDB - -> Inbox: ok
deactivate inboxDB

Inbox -> Inbox: Authorize(activity)

Inbox -> inboxHandler: Handle(activity)

activate inboxHandler
inboxHandler - -> Inbox: ok
deactivate inboxHandler

Inbox - -> inboxQueue: ACK

deactivate inboxQueue
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>